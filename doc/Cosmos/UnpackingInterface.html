<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Cosmos::UnpackingInterface - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
  var index_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/darkfish.js"></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">TcpipServerInterface
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-i-agg_pkt_map">#agg_pkt_map</a>
    
    <li class="calls-super" ><a href="#method-i-connect">#connect</a>
    
    <li ><a href="#method-i-packet_mapper">#packet_mapper</a>
    
    <li ><a href="#method-i-process">#process</a>
    
    <li class="calls-super" ><a href="#method-i-read">#read</a>
    
    <li ><a href="#method-i-target">#target</a>
    
    <li ><a href="#method-i-transforms">#transforms</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Cosmos::UnpackingInterface">
  <h1 id="class-Cosmos::UnpackingInterface" class="class">
    class Cosmos::UnpackingInterface
  </h1>

  <section class="description">
    
<p>A custom interface that unpacks aggregate packets (packets with many granules) into many  simple packets (packets with a single granule). This way we can use all the cosmos niceties  without having to send packets for individual measurements. Essentially we unpack an aggregate  packet into many packets that are stored in a queue that is read from. When the queue is empty  we look for new aggregate packets</p>

  </section>

  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-agg_pkt_map" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">agg_pkt_map</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Maps aggregate packets (packets with many granules) to simple packets (packets with a single granule) should have the form &#39;AggregatePacket&#39; =&gt; &#39;SimplePacket&#39; For example: &#39;Science&#39; =&gt; &#39;Science2&#39;</p>
          
          

          
          <div class="method-source-code" id="agg_pkt_map-source">
            <pre><span class="ruby-comment"># File lib/cosmos/unpacking_interface/unpacking_interface.rb, line 28</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">agg_pkt_map</span>
  {}
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-connect" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">connect</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="connect-source">
            <pre><span class="ruby-comment"># File lib/cosmos/unpacking_interface/unpacking_interface.rb, line 44</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">connect</span>
  <span class="ruby-ivar">@derived_queue</span> = []
  <span class="ruby-keyword">super</span>()
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-packet_mapper" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">packet_mapper</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Create and return a new instance of your own custom PacketMapper</p>
          
          

          
          <div class="method-source-code" id="packet_mapper-source">
            <pre><span class="ruby-comment"># File lib/cosmos/unpacking_interface/unpacking_interface.rb, line 40</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">packet_mapper</span>
  <span class="ruby-constant">PacketMapper</span>.<span class="ruby-identifier">new</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-process" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process</span><span
            class="method-args">(packet:, target:, agg_packet:, simple_packet:)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Unpack an aggregate packet if necessary and add resulting packets to the internal FIFO queue</p>
          
          

          
          <div class="method-source-code" id="process-source">
            <pre><span class="ruby-comment"># File lib/cosmos/unpacking_interface/unpacking_interface.rb, line 52</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process</span>(<span class="ruby-value">packet:</span>, <span class="ruby-value">target:</span>, <span class="ruby-value">agg_packet:</span>, <span class="ruby-value">simple_packet:</span>)   
   <span class="ruby-identifier">agg_pkt</span> = <span class="ruby-constant">System</span>.<span class="ruby-identifier">telemetry</span>.<span class="ruby-identifier">packet</span>(<span class="ruby-identifier">target</span>, <span class="ruby-identifier">agg_packet</span>)
   <span class="ruby-keyword">if</span>(<span class="ruby-identifier">agg_pkt</span>.<span class="ruby-identifier">identify?</span>(<span class="ruby-identifier">packet</span>.<span class="ruby-identifier">buffer</span>))
     <span class="ruby-identifier">processor</span> = <span class="ruby-constant">AggregatePacketProcesser</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">packet_mapper</span>, <span class="ruby-identifier">transforms</span>)
     <span class="ruby-identifier">agg_pkt</span>.<span class="ruby-identifier">buffer</span> = <span class="ruby-identifier">packet</span>.<span class="ruby-identifier">buffer</span>.<span class="ruby-identifier">clone</span>
     <span class="ruby-identifier">result</span> = <span class="ruby-identifier">processor</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-identifier">agg_pkt</span>, <span class="ruby-identifier">target</span>, <span class="ruby-identifier">simple_packet</span>)

     <span class="ruby-ivar">@derived_queue</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">result</span>)
   <span class="ruby-keyword">end</span>
   <span class="ruby-keyword">return</span> <span class="ruby-identifier">packet</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-read" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">read</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>This method is called by COSMOS internally, essentially if we have packets on the queue read those otherwise wait for a packet, and unpack if necessary</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="read-source">
            <pre><span class="ruby-comment"># File lib/cosmos/unpacking_interface/unpacking_interface.rb, line 67</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">read</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@derived_queue</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">p1</span> = <span class="ruby-ivar">@derived_queue</span>.<span class="ruby-identifier">shift</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">p1</span>
  <span class="ruby-keyword">else</span>

   <span class="ruby-comment"># This is a blocking call to wait for an actual packet to come over the wire</span>
   <span class="ruby-identifier">packet</span> = <span class="ruby-keyword">super</span>()

   <span class="ruby-identifier">agg_pkt_map</span>.<span class="ruby-identifier">select</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">agg_packet</span>, <span class="ruby-identifier">simple_packet</span><span class="ruby-operator">|</span>
     <span class="ruby-identifier">agg_pkt</span> = <span class="ruby-constant">System</span>.<span class="ruby-identifier">telemetry</span>.<span class="ruby-identifier">packet</span>(<span class="ruby-identifier">target</span>, <span class="ruby-identifier">agg_packet</span>)
     <span class="ruby-keyword">if</span>(<span class="ruby-identifier">agg_pkt</span>.<span class="ruby-identifier">identify?</span>(<span class="ruby-identifier">packet</span>.<span class="ruby-identifier">buffer</span>))      
       <span class="ruby-identifier">process</span>(<span class="ruby-value">packet:</span> <span class="ruby-identifier">packet</span>, <span class="ruby-value">target:</span> <span class="ruby-identifier">target</span>, <span class="ruby-value">agg_packet:</span> <span class="ruby-identifier">agg_packet</span>, <span class="ruby-value">simple_packet:</span> <span class="ruby-identifier">simple_packet</span>)
     <span class="ruby-keyword">end</span>
   <span class="ruby-keyword">end</span>
 
   <span class="ruby-keyword">return</span> <span class="ruby-identifier">packet</span>
  <span class="ruby-keyword">end</span> 
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-target" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">target</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a href="../Cosmos.html"><code>Cosmos</code></a> target interface is being used with</p>
          
          

          
          <div class="method-source-code" id="target-source">
            <pre><span class="ruby-comment"># File lib/cosmos/unpacking_interface/unpacking_interface.rb, line 34</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">target</span>
 <span class="ruby-string">&quot;&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-transforms" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">transforms</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Transformations defined on an item in a simple packet. Entries should be of the form: “&lt;TARGET&gt;-&lt;PACKET_NAME&gt;-&lt;ITEM_NAME&gt;” =&gt; Proc where the proc can accept the following parameters TargetName, ItemName, key, value, index index is the index of the granule in the aggregate packet that was transformed into the simple packet More info about procs can be found here: <a href="https://ruby-doc.org/core-2.4.1/Proc.html">ruby-doc.org/core-2.4.1/Proc.html</a></p>
          
          

          
          <div class="method-source-code" id="transforms-source">
            <pre><span class="ruby-comment"># File lib/cosmos/unpacking_interface/unpacking_interface.rb, line 20</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">transforms</span>
  {}
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.1.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

